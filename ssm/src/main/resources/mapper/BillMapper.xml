<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jd.edi.dao.BillMapper">
    <!-- -->
    <resultMap id="billCategoryMap" type="com.jd.edi.entity.Bill">
        <id column="id" property="id"/>
        <result column="bill_time" property="billTime"/>
        <result column="title" property="title"/>
        <result column="type_name" property="typeName"/>
        <result column="remake" property="remake"/>
        <result column="type_id" property="typeId"/>
        <result column="price" property="price"/>
    </resultMap>

    <select id="findBillList" resultMap="billCategoryMap">
        select b.*, t.name as typeName from bill b inner jion billtype t on  t.id = b.typeid
        <where>
            <if test="typeId != null">
                and b.typeId = #{typeId}
            </if>
            <if test="startDate != null">
                <![CDATA[ and b.billTime >= #{startDate}]]>
            </if>
            <if test="endDate!=null">
                <![CDATA[ and b.billTime <= #{endDate} ]]>
            </if>
        </where>
        order  by id desc
    </select>

    <insert id="saveBill">
        insert into bill(title, billtime, typeid, price, remark) values (#{title}, #{billYime}, #{typeId}, #{price}, #{remark})
    </insert>

    <update id="updateBill">
        update bill
        <set>
            <if test="title != null and title != ''">
                title = #{title}
            </if>
            <if test="billtime != null">
                billtime = #{billTime}
            </if>
            <if test="typeid != null">
                typeid = #{typeId}
            </if>
            <if test="price != null" >
                price = #{price}
            </if>
            <if test="remark">
                remark = #{remark}
            </if>
        </set>
        where id = #{id}
    </update>

    <delete id="deleteBill">
        delete from bill where id = #{id}
    </delete>

</mapper>